---
import { getCollection } from 'astro:content';

import '../styles/global.css';

import myPicture from '../assets/photo-moi.webp';
import MyRole from '../assets/logoMyRole.svg';
import arrowInverted from '../assets/arrow-inverted.svg';

import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Hero from '../components/Hero.astro';
import SectionTitle from '../components/SectionTitle.astro';
import Pill from '../components/Pill.astro';
import ProjectPreview from '../components/ProjectPreview.astro';

const competencies: { label: string }[] = [
	{ label: 'React' },
	{ label: 'Next' },
	{ label: 'Astro' },
    { label: 'Tailwind' },
    { label: 'Symfony' },
    { label: 'Git' },
    { label: 'Coolify' },
];

const projectsMmi = (await getCollection('mmi')).slice(0, 3);
const projectsMyrole = (await getCollection('myrole')).slice(0, 3);
const projectPerso = (await getCollection('perso')).slice(0, 3);

console.log('all projects', {
    projectsMmi,
    projectsMyrole,
    projectPerso
});
---
<Layout>
    <Header/>
    <Hero/>
    <main>
        <SectionTitle title="Qui suis-je ?" id="about">
            <div class="flex flex-col p-4 md:p-8 gap-4 md:gap-8">
                <div class="flex items-center gap-4">
                    <img src={myPicture.src} alt="Photo de Jocelyn">
                    <div class="flex flex-col gap-8">
                        <ul>
                            <li>Jocelyn</li>
                            <li>20 ans</li>
                            <li>3ème année en MMI</li>
                            <li>Aix-Les-Bains</li>
                        </ul>
                        <ul>
                            <li>Coach de volley</li>
                            <li>Passioné de sport</li>
                            <li>Jeux-vidéo</li>
                        </ul>
                    </div>
                </div>
                <div class="horizontal-line"></div>
                <div class="flex flex-col gap-8">
                    <h3>Compétences</h3>
                    <div class="flex flex-wrap gap-4 pr-8 lg:pr-42">
                        {competencies.map(({ label }) => (
                            <Pill>{label}</Pill>
                        ))}
                    </div>
                </div>
            </div>
        </SectionTitle>
        <div class="px-4 md:px-8">
            <div class="horizontal-line"></div>
        </div>
        <SectionTitle title="Mon alternance" id="myrole" isReverse>
            <div class="flex flex-col gap-8 md:gap-16 px-4 md:px-8">
                <div class="flex flex-col justify-between gap-8">
                    <h3>L'entreprise</h3>
                    <div class="flex justify-between items-center gap-4">
                        <img src={MyRole.src} alt="Logo de MyRole" class="w-1/2 p-8">
                        <div class="vertical-line"></div>
                        <p class="w-1/2 p-8">
                            Startup née en 2015 - automatise et accélère les tâches redondantes liées à la gestion administrative des acteurs sur les tournages de films
                        </p>
                    </div>
                </div>
                <div class="grid grid-cols-2 items-center text-center gap-8 px-8 lg:px-16 xl:px-32">
                    <div class="flex flex-col gap-4">
                        <span class="text-5xl font-['Sentient-Bold'] gsap-number" data-target="780">0</span>
                        <p class="px-4 lg:px-8">Projets de longs-métrages, séries et fictions TV</p>
                    </div>
                    <div class="flex flex-col gap-4">
                        <span class="text-5xl font-['Sentient-Bold'] gsap-number" data-target="370">0</span>
                        <p class="px-4 lg:px-8">Société de production clientes</p>
                    </div>
                    <div class="flex flex-col gap-4">
                        <span class="text-5xl font-['Sentient-Bold'] gsap-number" data-target="120000">0</span>
                        <p class="px-4 lg:px-8">Utilisateurs</p>
                    </div>
                    <div class="flex flex-col gap-4">
                        <span class="text-5xl font-['Sentient-Bold'] gsap-number" data-target="400000">0</span>
                        <p class="px-4 lg:px-8">Fichiers de paie hébergés</p>
                    </div>
                </div>
                <div class="horizontal-line"></div>
                <div class="flex flex-col gap-8">
                    <div class="flex gap-8">
                        <h3>Mon rôle</h3>
                        <div class="flex gap-4 items-center">
                            <Pill>18 novembre 2024</Pill>
                            <img src={arrowInverted.src} alt="Flèche vers la droite" class="w-8 h-8">
                            <Pill>18 novembre 2024</Pill>
                        </div>
                    </div>
                    <ul class="arrow-list flex flex-col gap-4">
                        <li>Intégration de contrats au format TWIG</li>
                        <li>Mise en place de procédures + cahier des charges pour une fonctionnalité d'intégration automatique</li>
                        <li>Développement de la V3 de la web application (Symfony, API platform, React,...)</li>
                        <li>Support utilisateur et agent de formation</li>
                    </ul>
                </div>
            </div>
        </SectionTitle>
        <div class="px-4 md:px-8">
            <div class="horizontal-line"></div>
        </div>
        <SectionTitle title="Mes projets" id="projects">
            {projectsMyrole.length > 0 && (
                <div class="flex flex-col gap-8 md:gap-16 px-4 md:px-8">
                    <h3>Entreprise</h3>
                    <ul class="flex flex-col">
                        {projectsMyrole.map((project, index) => (
                            <ProjectPreview project={project} index={index + 1} />
                        ))}
                    </ul>
                </div>
            )}
            {projectsMmi.length > 0 && (
                <div class="flex flex-col gap-8 md:gap-16 px-4 md:px-8 py-16">
                    <h3 class="text-right">Cours</h3>
                    <ul class="flex flex-col">
                        {projectsMmi.map((project, index) => (
                            <ProjectPreview project={project} index={index + 4} invert />
                        ))}
                    </ul>
                </div>
            )}
        </SectionTitle>
    </main>
</Layout>

<style>
    .arrow-list li {
        list-style: none;
        display: flex;
        align-items: center;
        gap: 0.5em;
        padding-inline-start: 0;
    }
    .arrow-list li::before {
        content: '';
        display: inline-block;
        width: 32px;
        height: 32px;
        background-image: url('../assets/arrow-inverted.svg');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        margin-right: 0.5rem;
        flex-shrink: 0;
    }
</style>

<script>
    import gsap from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    gsap.registerPlugin(ScrollTrigger);

    document.querySelectorAll('.gsap-number').forEach((el) => {
        const target = parseInt(el.getAttribute('data-target'), 10);
        gsap.fromTo(el, 
            { innerText: 0 }, 
            {
                innerText: target,
                duration: 1.5,
                ease: "power1.out",
                scrollTrigger: {
                    trigger: el,
                    start: "top 80%",
                    once: true,
                },
                snap: { innerText: 1 },
                onUpdate: function() {
                    el.innerText = Math.floor(this.targets()[0].innerText).toLocaleString('fr-FR');
                }
            }
        );
    });
</script>