---
import cn from 'mxcn';
import type { CollectionEntry } from 'astro:content';

interface Props {
	project: CollectionEntry<'mmi' | 'myrole' | 'perso'>;
    index: number;
	invert?: boolean;
}

const { index, invert } = Astro.props as Props;
const { data, slug } = Astro.props.project;

import Pill from './Pill.astro';
---
<li class="card w-full first:border-t border-b border-black p-4">
	<a href={`/work/${slug}`}>
		<div class="img hidden">
			<img src={data.img} alt={data.img_alt || ''} loading="lazy" decoding="async" />
		</div>
		<div class={cn('flex gap-8', {'flex-row-reverse': invert})}>
            <span class="text-8xl font-['Sentient-Bold'] w-1/7">0{index}</span>
            <div class="vertical-line-child"></div>
            <div class="flex flex-col gap-4 h-full">
                <h4 class={cn('font-medium text-4xl', {'text-right': invert})}>{data.title}</h4>
                <ul class="flex flex-wrap gap-2 tags-list">
                    {data.support.map((s) => <li><Pill invert>{s}</Pill></li>)}
                </ul>
            </div>
		</div>
	</a>
</li>

<style>
	.card .flex.gap-8 {
		align-items: center;
		min-height: 120px;
	}
	
	.card .flex.flex-col.gap-4 {
		display: flex;
		flex-direction: column;
		justify-content: center;
		height: 100%;
	}
	
	.card h4 {
		margin: 0;
	}
</style>

<script>
	import { gsap } from 'gsap';
	
	document.addEventListener('DOMContentLoaded', () => {
		document.querySelectorAll('.card').forEach((card) => {
			const tagsList = card.querySelector('.tags-list');
			const h4 = card.querySelector('h4');
			const flexDiv = card.querySelector('.flex.gap-8');
			const innerFlexDiv = card.querySelector('.flex.flex-col.gap-4');
			
			// État initial
			gsap.set(innerFlexDiv, {
				justifyContent: 'center',
				minHeight: '110px'
			});
			
			gsap.set(tagsList, { 
				maxHeight: 0, 
				opacity: 0,
			});
			
			// Animation au hover - SANS timeline
			card.addEventListener('mouseenter', () => {
				// Toutes les animations lancées exactement en même temps
				gsap.to(flexDiv, {
					minHeight: '160px',
					duration: 0.4,
					ease: 'power2.inOut'
				});
				
				gsap.to(innerFlexDiv, {
					justifyContent: 'flex-start',
					paddingTop: '16px',
					paddingBottom: '16px',
					duration: 0.4,
					ease: 'power2.inOut'
				});
				
				gsap.to(tagsList, {
					maxHeight: '60px',
					opacity: 1,
					marginTop: '16px',
					duration: 0.4,
					ease: 'power2.inOut'
				});
			});
			
			// Animation au mouse leave
			card.addEventListener('mouseleave', () => {
				// Toutes les animations inversées en même temps
				gsap.to(flexDiv, {
					minHeight: '120px',
					duration: 0.4,
					ease: 'power2.inOut'
				});
				
				gsap.to(innerFlexDiv, {
					justifyContent: 'center',
					paddingTop: '0px',
					paddingBottom: '0px',
					duration: 0.4,
					ease: 'power2.inOut'
				});
				
				gsap.to(tagsList, {
					maxHeight: 0,
					opacity: 0,
					marginTop: '0px',
					duration: 0.4,
					ease: 'power2.inOut'
				});
			});
		});
	});
</script>